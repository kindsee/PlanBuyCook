# GuÃ­a de Uso: Nueva FilosofÃ­a de PlanificaciÃ³n

## Escenario de ejemplo

Imagina que estÃ¡s el **domingo** y quieres planificar la semana. Tu almacÃ©n estÃ¡ **casi vacÃ­o** porque no has ido al supermercado.

---

## Paso 1: Planifica tu semana libremente ğŸ—“ï¸

**Lunes:**
- Almuerzo: Arroz con Pollo (100%)
- Cena: Pasta Carbonara (50%)

**Martes:**
- Almuerzo: Pasta Carbonara (50%) â† resto del de ayer
- Cena: Ensalada CÃ©sar (100%)

**MiÃ©rcoles:**
- Almuerzo: Pedir comida ğŸ•
- Cena: Tortilla de Patatas (100%)

**Jueves:**
- Almuerzo: Comer fuera ğŸ´
- Cena: Arroz con Pollo (100%)

### âœ… Resultado
Todos los platos se asignan **sin errores**, aunque no tengas ingredientes en casa.

---

## Paso 2: Genera la lista de compras ğŸ“

Desde la secciÃ³n "Lista de Compra", genera una nueva lista para la semana.

### El sistema calcula automÃ¡ticamente:

#### Arroz con Pollo (2 veces al 100%)
```
Pollo: 2kg necesario
Arroz: 800g necesario
Cebolla: 400g necesario
Tomate: 600g necesario
```

#### Pasta Carbonara (1 vez completa = 50% + 50%)
```
Pasta: 400g necesario
Bacon: 200g necesario
Huevo: 4 unidades necesario
Queso parmesano: 100g necesario
```

#### Ensalada CÃ©sar (1 vez)
```
Lechuga: 1 unidad necesario
Pollo: 300g necesario
Pan: 100g necesario
Queso parmesano: 50g necesario
```

#### Tortilla de Patatas (1 vez)
```
Patata: 800g necesario
Huevo: 6 unidades necesario
Cebolla: 200g necesario
```

### Lista final generada:

| Ingrediente | Necesario | Disponible | Comprar |
|-------------|-----------|------------|---------|
| Pollo | 2.3 kg | 0 kg | **2.3 kg** |
| Arroz | 800 g | 100 g | **700 g** |
| Cebolla | 600 g | 0 g | **600 g** |
| Tomate | 600 g | 0 g | **600 g** |
| Pasta | 400 g | 0 g | **400 g** |
| Bacon | 200 g | 0 g | **200 g** |
| Huevo | 10 unidades | 3 unidades | **7 unidades** |
| Queso parmesano | 150 g | 0 g | **150 g** |
| Lechuga | 1 unidad | 0 unidad | **1 unidad** |
| Pan | 100 g | 0 g | **100 g** |
| Patata | 800 g | 200 g | **600 g** |

### ğŸ“± Imprime o guarda la lista en tu mÃ³vil

---

## Paso 3: Ve a comprar ğŸ›’

Vas al supermercado con tu lista y compras todo lo necesario.

---

## Paso 4: Marca la compra como completada âœ…

Desde la aplicaciÃ³n, marca la lista como "Completada".

### Â¿QuÃ© pasa?
El sistema **aÃ±ade automÃ¡ticamente** todos los ingredientes comprados a tu almacÃ©n:

```
âœ“ Pollo: 0 kg â†’ 2.3 kg
âœ“ Arroz: 100 g â†’ 800 g
âœ“ Cebolla: 0 g â†’ 600 g
âœ“ Tomate: 0 g â†’ 600 g
âœ“ Pasta: 0 g â†’ 400 g
âœ“ Bacon: 0 g â†’ 200 g
âœ“ Huevo: 3 unidades â†’ 10 unidades
âœ“ Queso parmesano: 0 g â†’ 150 g
âœ“ Lechuga: 0 unidades â†’ 1 unidad
âœ“ Pan: 0 g â†’ 100 g
âœ“ Patata: 200 g â†’ 800 g
```

---

## Casos especiales

### Si cambias de opiniÃ³n ğŸ”„

**SituaciÃ³n:** El martes decides que en lugar de Ensalada CÃ©sar prefieres Pizza casera.

**AcciÃ³n:**
1. Elimina "Ensalada CÃ©sar" del martes
2. AÃ±ade "Pizza casera" al martes

**Resultado:**
- âœ… Los ingredientes de Ensalada NO se afectan (nunca se descontaron)
- âœ… Puedes regenerar la lista de compras con los cambios
- âœ… La nueva lista incluirÃ¡ ingredientes de Pizza y excluirÃ¡ los de Ensalada

### Si vas comprando gradualmente ğŸ“¦

**SituaciÃ³n:** Compras algunas cosas el lunes y otras el miÃ©rcoles.

**OpciÃ³n 1 - Lista parcial:**
1. Marca solo algunos items como "comprados" individualmente
2. Cuando termines, marca la lista como "completada"
3. Solo se aÃ±adirÃ¡n al almacÃ©n los items marcados

**OpciÃ³n 2 - AÃ±adir manualmente:**
1. Ve a "AlmacÃ©n"
2. AÃ±ade manualmente lo que compraste
3. Cuando regeneres la lista, ya no te pedirÃ¡ esos ingredientes

### Si cocinas algo no planificado ğŸ³

**SituaciÃ³n:** El miÃ©rcoles decides cocinar algo que no estaba planificado.

**AcciÃ³n:**
1. Ve a "AlmacÃ©n"
2. Resta manualmente los ingredientes que usaste

**Futuro:** HabrÃ¡ funciÃ³n para marcar comidas como "consumidas" automÃ¡ticamente.

---

## Consejos y buenas prÃ¡cticas ğŸ’¡

### 1. Planifica toda la semana de una vez
- MÃ¡s eficiente para generar una sola lista
- Aprovechas mejor las compras (ej: 1 pollo para 2 comidas)

### 2. Usa los porcentajes inteligentemente
- Si un plato rinde mucho, Ãºsalo en varias comidas:
  - DÃ­a 1: Pasta 50%
  - DÃ­a 2: Pasta 50%
- Ahorra tiempo cocinando y comprando

### 3. MantÃ©n el almacÃ©n actualizado
- Si compras algo fuera de la lista, aÃ±Ã¡delo manualmente
- Si usas ingredientes, rÃ©stalos manualmente (por ahora)

### 4. Marca comidas especiales
- "Pedir comida" y "Comer fuera" NO consumen ingredientes
- Ãšsalos para dÃ­as que sabes que no cocinarÃ¡s

### 5. Regenera la lista si cambias planes
- Puedes generar mÃºltiples listas para el mismo perÃ­odo
- Ãštil si cambias de opiniÃ³n o aÃ±ades mÃ¡s comidas

---

## ComparaciÃ³n visual: Antes vs. Ahora

### âŒ ANTES (filosofÃ­a antigua)

```
1. Ver almacÃ©n (tienes solo 100g arroz)
2. Intentar planificar "Arroz con Pollo" 
   â†’ âŒ ERROR: "Faltan 700g de arroz"
3. No puedes planificar nada hasta comprar
4. Ir al super sin lista
5. Comprar "a ojo"
6. Volver e intentar planificar de nuevo
```

### âœ… AHORA (nueva filosofÃ­a)

```
1. Planificar toda la semana libremente âœ“
2. Generar lista automÃ¡tica âœ“
3. Ir al super con lista precisa âœ“
4. Comprar exactamente lo necesario âœ“
5. Marcar como completado âœ“
6. Cocinar durante la semana âœ“
```

---

## Flujo tÃ©cnico (para desarrolladores)

### Al asignar un plato
```python
# NO hace esto:
# check_sufficient_stock() â†’ Error si falta stock
# update_stock(subtract) â†’ Descuenta ingredientes

# SÃ hace esto:
batch = DishBatch(
    dish_id=dish_id,
    percentage_remaining=100.0,
    ingredients_deducted=False  # â† Virtual
)
MealDish(meal=meal, batch=batch, percentage=50)
```

### Al generar lista
```python
# Calcula ingredientes necesarios
for meal in week_meals:
    for meal_dish in meal.meal_dishes:
        needed[ingredient] += quantity * (percentage/100)

# Compara con stock
for ingredient, quantity_needed in needed.items():
    available = PantryStock.get(ingredient)
    to_buy = max(0, quantity_needed - available)
    
    ShoppingItem(
        ingredient=ingredient,
        quantity_to_buy=to_buy  # Solo lo que falta
    )
```

### Al completar compra
```python
for item in shopping_list.items:
    PantryStock.update_stock(
        item.ingredient,
        item.quantity_to_buy,
        operation='add'  # â† AÃ±ade al almacÃ©n
    )
```

---

## Preguntas frecuentes â“

**P: Â¿QuÃ© pasa con los batches de la versiÃ³n anterior?**  
R: Ejecuta el script `migrate_to_virtual_batches.py` para migrarlos.

**P: Â¿Puedo seguir usando el almacÃ©n manualmente?**  
R: SÃ­, puedes aÃ±adir/restar ingredientes manualmente sin problemas.

**P: Â¿La lista de compras puede tener items negativos?**  
R: No, la fÃ³rmula es `max(0, necesario - disponible)`.

**P: Â¿Puedo generar varias listas para fechas solapadas?**  
R: SÃ­, pero cada una calcularÃ¡ independientemente. La Ãºltima completada actualiza el stock.

**P: Â¿CuÃ¡ndo se implementarÃ¡ el "marcar como consumido"?**  
R: Es una funcionalidad futura. Por ahora, ajusta el almacÃ©n manualmente si cocinas algo.

---

## Resumen en 3 pasos

1. **Planifica** lo que quieres comer (sin lÃ­mites)
2. **Genera lista** â†’ ve quÃ© te falta
3. **Compra y completa** â†’ el almacÃ©n se actualiza solo

Â¡Disfruta de tu nueva libertad de planificaciÃ³n! ğŸ‰
